import{j as e,B as w,c as g}from"./config.DA722Lej.js";import{r as o}from"./index.BVn2TZg3.js";import{c as H,S as E,A as P,a as k,b as F,d as Q,e as W,f as D}from"./site-header.CcIO_pl4.js";import{C as j,a as y,b as z,c as T,d as U}from"./card.BSoSeF1_.js";import{I as d}from"./input.BGbgNwpT.js";import{L as m}from"./label.C2QC9qaa.js";import{A as K,a as V,b as X}from"./alert.O9yGhm7j.js";import{I as Y}from"./IconLoader.CpSXqs7V.js";import{I as Z}from"./IconCheck.CXf9P-ea.js";import{I as ee}from"./IconAlertCircle.CnD7sKOg.js";import{I as $,a as se,b as ae,c as re}from"./IconUser.DkuoL3Ke.js";import{I as te}from"./IconCalendar.DYjqBcxp.js";import"./createLucideIcon.Cw3puCNq.js";/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M5 7h1a2 2 0 0 0 2 -2a1 1 0 0 1 1 -1h6a1 1 0 0 1 1 1a2 2 0 0 0 2 2h1a2 2 0 0 1 2 2v9a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-9a2 2 0 0 1 2 -2",key:"svg-0"}],["path",{d:"M9 13a3 3 0 1 0 6 0a3 3 0 0 0 -6 0",key:"svg-1"}]],ie=H("outline","camera","Camera",le);function ve(){const[v,M]=o.useState(null),[h,N]=o.useState(null),[B,J]=o.useState(!1),[L,S]=o.useState(!0),[b,A]=o.useState(!1),[u,x]=o.useState(null),[t,_]=o.useState(!1),[a,p]=o.useState({id:0,first_name:"",last_name:"",email:"",phone:"",address:"",city:"",country:"",birth_date:"",profile_photo:"",role:""}),f=s=>({id:s.id||0,first_name:s.first_name||"",last_name:s.last_name||"",email:s.email||"",phone:s.phone_number||"",address:s.address||"",city:s.country_location||"",country:s.country||"Perú",birth_date:s.birth_date?s.birth_date.split("T")[0]:"",profile_photo:s.profile_photo||"/academico/images/9440461.webp",role:s.role||"student",dni:s.dni||"",document:s.document||"",country_location:s.country_location||"",gender:s.gender||""});o.useEffect(()=>{(async()=>{try{S(!0);const r=window.localStorage.getItem("token"),l=window.localStorage.getItem("user");M(r??null);let c=null;if(l)try{const i=JSON.parse(l);N(i),p(f(i)),c=i.id,console.log("Usuario del localStorage:",i)}catch(i){console.error("Error parsing localStorage user:",i)}if(r&&c){const i=r.replace(/^"|"$/g,"");console.log("Fetching profile for user ID:",c);const C=await fetch(`${g.apiUrl}${g.endpoints.users.getById}`.replace(":id",c.toString()),{headers:{Authorization:`Bearer ${i}`,Accept:"application/json"}});if(C.ok){const I=await C.json();N(I),p(f(I)),localStorage.setItem("user",JSON.stringify(I))}else console.error("Error fetching profile:",await C.text())}else console.log("No se pudo obtener userId para hacer fetch a la API")}catch(r){console.error("Error loading profile:",r),x({type:"error",text:"Error al cargar el perfil. Por favor, recarga la página."})}finally{S(!1),J(!0)}})()},[]);const n=(s,r)=>{p(l=>({...l,[s]:r}))},q=async s=>{s.preventDefault(),A(!0);try{const r=v?.replace(/^"|"$/g,""),l=await fetch(`${g.apiUrl}${g.endpoints.users.update}`.replace(":id",h.id),{method:"PUT",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({first_name:a.first_name,last_name:a.last_name,email:a.email,phone_number:a.phone,address:a.address,country_location:a.city,country:a.country,birth_date:a.birth_date,profile_photo:a.profile_photo})});if(!l.ok){const i=await l.json();throw new Error(i.message||"Error al actualizar el perfil.")}const c=await l.json();N(c),p(f(c)),localStorage.setItem("user",JSON.stringify(c)),x({type:"success",text:"¡Perfil actualizado exitosamente!"}),_(!1),setTimeout(()=>x(null),3e3)}catch(r){console.error("Error actualizando perfil:",r),x({type:"error",text:r instanceof Error?r.message:"Error al actualizar el perfil. Por favor, intenta nuevamente."})}finally{A(!1)}},O=()=>{h&&p(f(h)),_(!1),x(null)},R=s=>Array.isArray(s)?s.map(l=>({student:"Estudiante",teacher:"Docente",admin:"Administrador",graduate:"Egresado"})[l]||l).join(", "):{student:"Estudiante",teacher:"Docente",admin:"Administrador",graduate:"Egresado"}[s]||s,G=(s,r)=>`${s?.[0]||""}${r?.[0]||""}`.toUpperCase();return!B||L?e.jsxs(E,{style:{"--sidebar-width":"calc(var(--spacing) * 72)","--header-height":"calc(var(--spacing) * 12)"},children:[e.jsx(P,{variant:"inset",token:v,user:h}),e.jsxs(k,{children:[e.jsx(F,{title:"Mi Cuenta"}),e.jsx("div",{className:"flex flex-1 flex-col",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Y,{className:"h-12 w-12 animate-spin text-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Cargando información del perfil..."})]})})})]})]}):e.jsxs(E,{style:{"--sidebar-width":"calc(var(--spacing) * 72)","--header-height":"calc(var(--spacing) * 12)"},children:[e.jsx(P,{variant:"inset",token:v,user:h}),e.jsxs(k,{children:[e.jsx(F,{title:"Mi Cuenta"}),e.jsx("div",{className:"flex flex-1 flex-col",children:e.jsx("div",{className:"@container/main flex flex-1 flex-col gap-2",children:e.jsx("div",{className:"flex flex-col gap-4 py-4 md:gap-6 md:py-6",children:e.jsx("section",{className:"px-4 md:px-6 lg:px-10 max-w-5xl mx-auto w-full",children:e.jsxs("div",{className:"space-y-6",children:[u&&e.jsxs(K,{variant:u.type==="error"?"destructive":"default",children:[u.type==="success"?e.jsx(Z,{className:"h-4 w-4"}):e.jsx(ee,{className:"h-4 w-4"}),e.jsx(V,{children:u.type==="success"?"¡Éxito!":"Error"}),e.jsx(X,{children:u.text})]}),e.jsx(j,{children:e.jsx(y,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-6",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(Q,{className:"h-32 w-32",children:[e.jsx(W,{src:a.profile_photo,alt:a.first_name}),e.jsx(D,{className:"text-3xl",children:G(a.first_name,a.last_name)})]}),t&&e.jsx("button",{className:"absolute bottom-0 right-0 p-2 bg-primary text-primary-foreground rounded-full hover:bg-primary/90 transition-colors",type:"button",children:e.jsx(ie,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex-1 text-center md:text-left space-y-2",children:[e.jsxs("h2",{className:"text-3xl font-bold",children:[a.first_name," ",a.last_name]}),e.jsx("p",{className:"text-muted-foreground text-lg",children:a.email}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center md:justify-start",children:[e.jsx("span",{className:"px-3 py-1 bg-primary/10 text-primary rounded-full text-sm font-medium border border-primary/20",children:R(a.role)}),e.jsx("span",{className:"px-3 py-1 bg-green-500/10 text-green-500 rounded-full text-sm font-medium border border-green-500/20",children:"Cuenta Activa"}),a.dni&&e.jsxs("span",{className:"px-3 py-1 bg-blue-500/10 text-blue-500 rounded-full text-sm font-medium border border-blue-500/20",children:["DNI: ",a.dni]})]})]}),!t&&e.jsx(w,{onClick:()=>_(!0),variant:"outline",className:"mt-4 md:mt-0",children:"Editar Perfil"})]})})}),e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[e.jsxs(j,{children:[e.jsxs(z,{children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5 text-primary"}),"Información Personal"]}),e.jsx(U,{children:t?"Actualiza tu información personal":"Tu información personal"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"first_name",children:"Nombre(s) *"}),e.jsx(d,{id:"first_name",placeholder:"Juan",value:a.first_name,onChange:s=>n("first_name",s.target.value),disabled:!t,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"last_name",children:"Apellido(s) *"}),e.jsx(d,{id:"last_name",placeholder:"Pérez García",value:a.last_name,onChange:s=>n("last_name",s.target.value),disabled:!t,required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"dni",children:"DNI"}),e.jsx(d,{id:"dni",placeholder:"12345678",value:a.dni||"",onChange:s=>n("dni",s.target.value),disabled:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"email",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),"Correo Electrónico *"]})}),e.jsx(d,{id:"email",type:"email",placeholder:"juan.perez@example.com",value:a.email,onChange:s=>n("email",s.target.value),disabled:!t,required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"phone",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Teléfono"]})}),e.jsx(d,{id:"phone",type:"tel",placeholder:"+51 999 999 999",value:a.phone,onChange:s=>n("phone",s.target.value),disabled:!t})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"birth_date",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Fecha de Nacimiento"]})}),e.jsx(d,{id:"birth_date",type:"date",value:a.birth_date,onChange:s=>n("birth_date",s.target.value),disabled:!t})]})]})]})]}),e.jsxs(j,{children:[e.jsxs(z,{children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-primary"}),"Ubicación"]}),e.jsx(U,{children:t?"Actualiza tu dirección":"Tu dirección actual"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"address",children:"Dirección"}),e.jsx(d,{id:"address",placeholder:"Av. Ejemplo 123, Dpto. 456",value:a.address,onChange:s=>n("address",s.target.value),disabled:!t})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"city",children:"Ciudad/Región"}),e.jsx(d,{id:"city",placeholder:"Arequipa",value:a.city,onChange:s=>n("city",s.target.value),disabled:!t})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"country",children:"País"}),e.jsx(d,{id:"country",placeholder:"Perú",value:a.country,onChange:s=>n("country",s.target.value),disabled:!t})]})]})]})]}),t&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx(w,{type:"button",variant:"outline",className:"flex-1",onClick:O,disabled:b,children:"Cancelar"}),e.jsx(w,{type:"submit",className:"flex-1",disabled:b,children:b?"Guardando...":"Guardar Cambios"})]})]}),e.jsx(j,{className:"bg-blue-500/5 border-blue-500/20",children:e.jsx(y,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"p-3 bg-blue-500/10 rounded-lg",children:e.jsx($,{className:"h-6 w-6 text-blue-500"})})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"font-semibold",children:"Protege tu información"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Mantén tus datos actualizados para mejorar tu experiencia en la plataforma. Si necesitas cambiar tu contraseña o cerrar tu cuenta, contacta con soporte."})]})]})})})]})})})})})]})]})}export{ve as default};
