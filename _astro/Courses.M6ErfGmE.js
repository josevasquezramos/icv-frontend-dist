import{j as e,B as q,c as v}from"./config.sbWlfyv2.js";import{r as i}from"./index.BVn2TZg3.js";import{c as O,d as R,e as z,f as V,S as H,A as W,a as J,b as Q}from"./site-header.B3j0ufG-.js";import{C as I,b as L,a as G,e as X}from"./card.DSskY0du.js";import{P as K}from"./progress.C8SBIL1h.js";import{t as k}from"./index.CNnhNARM.js";import{c as Y}from"./createLucideIcon.Cw3puCNq.js";import{I as g}from"./input.BIKkWM1R.js";import{L as l}from"./label.-hguu2tI.js";import{A as T,a as U,b as P}from"./alert.CrxqG8Ya.js";import{S as F,a as D,b as A,c as $,d as E}from"./select.DFHxNlGU.js";import{I as M}from"./IconCheck.Bps8dZO5.js";import{I as B}from"./IconAlertCircle.DVcUbgx8.js";import{C as Z}from"./CloudinaryUploader.CM28a9Ip.js";import"./video.BZwMdyWj.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],se=Y("download",ee);/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M18 6l-12 12",key:"svg-0"}],["path",{d:"M6 6l12 12",key:"svg-1"}]],ae=O("outline","x","X",re);function te(){return e.jsx("section",{className:"px-4 md:px-6 lg:px-10",children:e.jsx("p",{className:"text-muted-foreground",children:'Vista principal de "Mis Cursos". Aquí se mostrarán los cursos activos del usuario.'})})}function oe(){const[f,j]=i.useState([]),[d,m]=i.useState(!0),[h,y]=i.useState(null),[x,N]=i.useState(null);i.useEffect(()=>{(async()=>{try{m(!0);const o=window.localStorage.getItem("token");N(o??null);const u=window.localStorage.getItem("user"),C=u?JSON.parse(u).id:null;if(!C){k.error("No se pudo identificar al usuario");return}const S=v.endpoints.groups.getGroupsCompleted.replace(":userId",String(C)),c=`${v.apiUrl}${S}`,n=o?.replace(/^"|"$/g,""),t=await fetch(c,{method:"GET",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Error al obtener los grupos completados");const s=await t.json();s.groups&&Array.isArray(s.groups)?j(s.groups):j([])}catch(o){console.error("Error fetching completed groups:",o),k.error("Error al cargar los cursos completados"),j([])}finally{m(!1)}})()},[]);const w=async(a,o)=>{if(!o){k.error("Este curso no tiene un certificado disponible.");return}y(a);try{const u=x?.replace(/^"|"$/g,""),C=v.endpoints.certificates.generate.replace(":credentialId",String(o)),S=`${v.apiUrl}${C}`;console.log("Descargando certificado desde:",S);const c=await fetch(S,{method:"GET",headers:{Authorization:`Bearer ${u}`,Accept:"application/pdf"}});if(!c.ok){const p=await c.json().catch(()=>({}));throw new Error(p.message||"Error al generar el certificado")}const n=await c.blob(),t=window.URL.createObjectURL(n),s=document.createElement("a");s.href=t,s.download=`certificado-${a}.pdf`,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(t),k.success("¡Certificado descargado exitosamente!")}catch(u){console.error("Error descargando certificado:",u),k.error(u instanceof Error?u.message:"Error al descargar el certificado. Por favor, intenta nuevamente.")}finally{y(null)}},_=a=>a.find(o=>o.role==="teacher")?.user||null,r=a=>a.course_image||"/academico/images/default-group-01.webp";return d?e.jsx("section",{className:"px-4 md:px-6 lg:px-10",children:e.jsx("p",{className:"text-center text-muted-foreground py-12",children:"Cargando cursos completados..."})}):e.jsx("section",{className:"px-4 md:px-6 lg:px-10",children:f.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-12",children:"No tienes cursos completados aún."}):e.jsx("div",{className:"grid gap-6 sm:grid-cols-2 lg:grid-cols-3",children:f.map(a=>{const o=_(a.participants),u=r(a.course);return e.jsxs(I,{className:"overflow-hidden transition-all hover:shadow-lg flex flex-col",children:[e.jsx("div",{className:"aspect-video overflow-hidden cursor-pointer",children:e.jsx("img",{src:u,alt:a.course.name,className:"w-full h-full object-cover hover:scale-105 transition-transform",onClick:()=>window.location.href=`/academico/groups/${a.id}`})}),e.jsxs(L,{className:"pb-3",children:[e.jsx("h3",{className:"font-semibold text-lg",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.course.name})]}),e.jsxs(G,{className:"space-y-4 flex-1",children:[o&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(R,{className:"h-10 w-10",children:[e.jsx(z,{src:o.profile_photo}),e.jsx(V,{children:o.full_name?.split(" ").map(C=>C[0]).join("")||"T"})]}),e.jsx("p",{className:"text-sm font-medium",children:o.full_name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"Completado"}),e.jsx("span",{className:"text-green-600 font-medium",children:"100%"})]}),e.jsx(K,{value:100})]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["Inicio: ",new Date(a.start_date).toLocaleDateString()]}),e.jsxs("p",{children:["Fin: ",new Date(a.end_date).toLocaleDateString()]})]})]}),e.jsxs(X,{className:"gap-2",children:[e.jsxs(q,{variant:"outline",className:"flex-1 gap-2",onClick:()=>w(a.id,a.credential_id),disabled:h===a.id,children:[e.jsx(se,{className:"h-4 w-4"}),h===a.id?"Descargando...":"Certificado"]}),e.jsx(q,{className:"flex-1",onClick:()=>window.location.href=`/academico/groups/${a.id}`,children:"Ver Detalles"})]})]},a.id)})})})}function ie({token:f,user:j}){const[d,m]=i.useState(!1),[h,y]=i.useState(null),[x,N]=i.useState([]),[w,_]=i.useState(!0),r=f?.replace(/^"|"$/g,""),[a,o]=i.useState({course_id:"",code:"",name:"",start_date:"",end_date:""});i.useEffect(()=>{(async()=>{_(!0);try{const n=await fetch(`${v.apiUrl}${v.endpoints.courses.getAll}`,{method:"GET",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(n.ok){const t=await n.json();N(t)}}catch(n){console.error("Error cargando cursos:",n)}finally{_(!1)}})()},[f]);const u=c=>{const{id:n,value:t}=c.target;o(s=>({...s,[n]:t}))},C=c=>{o(n=>({...n,course_id:c}))},S=async c=>{if(c.preventDefault(),!j){y({type:"error",text:"Usuario no autenticado"});return}m(!0);try{const n={course_id:parseInt(a.course_id),code:a.code,name:a.name,start_date:a.start_date,end_date:a.end_date,teacher_id:j.id};console.log("Enviando datos:",n);const t=await fetch(`${v.apiUrl}${v.endpoints.groups.create}`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(n)}),s=await t.json();if(!t.ok)throw new Error(s.message||"Error al crear el grupo");console.log("Grupo creado:",s),y({type:"success",text:`¡Grupo creado exitosamente! El grupo "${a.name}" ha sido registrado.`}),o({course_id:"",code:"",name:"",start_date:"",end_date:""}),setTimeout(()=>{window.location.hash=""},1500)}catch(n){console.error("Error al crear grupo:",n),y({type:"error",text:n instanceof Error?n.message:"Ocurrió un error inesperado al crear el grupo"})}finally{m(!1)}};return e.jsx("section",{className:"px-4 md:px-6 lg:px-10",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs(I,{children:[e.jsxs(L,{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Crear Nuevo Grupo"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completa la información para crear un nuevo grupo académico"})]}),e.jsxs(G,{children:[h&&e.jsxs(T,{variant:h.type==="error"?"destructive":"default",className:"mb-6",children:[h.type==="success"?e.jsx(M,{className:"h-4 w-4"}):e.jsx(B,{className:"h-4 w-4"}),e.jsx(U,{children:h.type==="success"?"¡Éxito!":"Error"}),e.jsx(P,{children:h.text})]}),e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"course_id",children:"Curso *"}),e.jsxs(F,{value:a.course_id,onValueChange:C,disabled:w,children:[e.jsx(D,{id:"course_id",children:e.jsx(A,{placeholder:w?"Cargando cursos...":"Selecciona un curso"})}),e.jsx($,{children:x.map(c=>e.jsx(E,{value:String(c.id),children:c.title},c.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"code",children:"Código del Grupo *"}),e.jsx(g,{id:"code",placeholder:"Ej: GRP-2024-001",value:a.code,onChange:u,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"name",children:"Nombre del Grupo *"}),e.jsx(g,{id:"name",placeholder:"Ej: Grupo A - Mañana",value:a.name,onChange:u,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"start_date",children:"Fecha de Inicio *"}),e.jsx(g,{id:"start_date",type:"date",value:a.start_date,onChange:u,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"end_date",children:"Fecha de Fin *"}),e.jsx(g,{id:"end_date",type:"date",value:a.end_date,onChange:u,required:!0})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(q,{type:"button",variant:"outline",className:"flex-1",onClick:()=>window.location.hash="",disabled:d,children:"Cancelar"}),e.jsx(q,{type:"submit",className:"flex-1",disabled:d,children:d?"Creando...":"Crear Grupo"})]})]})]})]})})})}function ne({token:f}){const[j,d]=i.useState(!1),[m,h]=i.useState(null),[y,x]=i.useState([]),[N,w]=i.useState(!0),_=f?.replace(/^"|"$/g,""),[r,a]=i.useState({course_id:"",title:"",name:"",description:"",level:"basic",course_image:"",video_url:"",duration:"",sessions:"",selling_price:"",discount_price:"",prerequisites:[],certificate_issuer:""});i.useEffect(()=>{(async()=>{w(!0);try{const s=await fetch(`${v.apiUrl}${v.endpoints.courses.getAll}`,{method:"GET",headers:{Authorization:`Bearer ${_}`,"Content-Type":"application/json"}});if(s.ok){const p=await s.json();x(p)}}catch(s){console.error("Error cargando cursos:",s)}finally{w(!1)}})()},[f]);const o=t=>{const{id:s,value:p}=t.target;a(b=>({...b,[s]:p}))},u=(t,s)=>{a(p=>({...p,[t]:s}))},C=t=>{console.log("courseid entrante: ",t);const s=t.toString();!r.prerequisites.some(b=>b.toString()===s)&&t!=="none"?(console.log("prerrequisitos actuales: ",r.prerequisites),a(b=>({...b,prerequisites:[...b.prerequisites,s]}))):console.log("El curso ya existe en prerrequisitos o es 'none'")},S=t=>{a(s=>({...s,prerequisites:s.prerequisites.filter(p=>p!==t)}))},c=async t=>{t.preventDefault(),d(!0);try{const s={course_id:parseInt(r.course_id),title:r.title,level:r.level};r.name&&(s.name=r.name),r.description&&(s.description=r.description),r.course_image&&(s.course_image=r.course_image),r.video_url&&(s.video_url=r.video_url),r.duration&&(s.duration=parseFloat(r.duration)),r.sessions&&(s.sessions=parseInt(r.sessions)),r.selling_price&&(s.selling_price=parseFloat(r.selling_price)),r.discount_price&&(s.discount_price=parseFloat(r.discount_price)),r.prerequisites.length>0&&(s.prerequisites=r.prerequisites.join(",")),r.certificate_issuer&&(s.certificate_issuer=r.certificate_issuer),console.log("Enviando datos:",s);const p=await fetch(`${v.apiUrl}${v.endpoints.courses.create}`,{method:"POST",headers:{Authorization:`Bearer ${_}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(s)}),b=await p.json();if(!p.ok)throw new Error(b.message||"Error al crear el curso");console.log("Curso creado:",b),h({type:"success",text:`¡Curso creado exitosamente! El curso "${r.title}" ha sido registrado.`}),a({course_id:"",title:"",name:"",description:"",level:"basic",course_image:"",video_url:"",duration:"",sessions:"",selling_price:"",discount_price:"",prerequisites:[],certificate_issuer:""}),setTimeout(()=>{window.location.href="/academico/dashboard/catalogo"},1500)}catch(s){console.error("Error al crear curso:",s),h({type:"error",text:s instanceof Error?s.message:"Ocurrió un error inesperado al crear el curso"})}finally{d(!1)}},n=t=>{const s=y.find(p=>p.id===t||p.id?.toString()===t);return console.log("dato del curso: ",s),s?.title};return e.jsx("section",{className:"px-4 md:px-6 lg:px-10",children:e.jsx("div",{className:"max-w-3xl mx-auto",children:e.jsxs(I,{children:[e.jsxs(L,{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Crear Nuevo Curso"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Define la información del curso que será utilizado para crear grupos"})]}),e.jsxs(G,{children:[m&&e.jsxs(T,{variant:m.type==="error"?"destructive":"default",className:"mb-6",children:[m.type==="success"?e.jsx(M,{className:"h-4 w-4"}):e.jsx(B,{className:"h-4 w-4"}),e.jsx(U,{children:m.type==="success"?"¡Éxito!":"Error"}),e.jsx(P,{children:m.text})]}),e.jsxs("form",{onSubmit:c,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Información Básica"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"course_id",children:"ID del Curso *"}),e.jsx(g,{id:"course_id",type:"number",placeholder:"1001",value:r.course_id,onChange:o,min:"1",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"title",children:"Título *"}),e.jsx(g,{id:"title",placeholder:"Desarrollo Web Fullstack",maxLength:255,value:r.title,onChange:o,required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"name",children:"Nombre (opcional)"}),e.jsx(g,{id:"name",placeholder:"DWF 2024",maxLength:200,value:r.name,onChange:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"description",children:"Descripción"}),e.jsx("textarea",{id:"description",className:"flex min-h-[120px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"Describe el contenido, objetivos y metodología del curso...",value:r.description,onChange:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"level",children:"Nivel *"}),e.jsxs(F,{value:r.level,onValueChange:t=>u("level",t),children:[e.jsx(D,{id:"level",children:e.jsx(A,{placeholder:"Selecciona un nivel"})}),e.jsxs($,{children:[e.jsx(E,{value:"basic",children:"Básico"}),e.jsx(E,{value:"intermediate",children:"Intermedio"}),e.jsx(E,{value:"advanced",children:"Avanzado"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Multimedia"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"course_image",children:"URL de Imagen del Curso"}),e.jsx(Z,{onUpload:t=>a(s=>({...s,course_image:t})),acceptType:"image"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"video_url",children:"URL de Video Promocional"}),e.jsx(g,{id:"video_url",type:"url",placeholder:"https://youtube.com/watch?v=...",maxLength:255,value:r.video_url,onChange:o})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Detalles del Curso"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"duration",children:"Duración (horas)"}),e.jsx(g,{id:"duration",type:"number",step:"1",placeholder:"120",min:"1",value:r.duration,onChange:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"sessions",children:"Número de Sesiones"}),e.jsx(g,{id:"sessions",type:"number",placeholder:"40",min:"0",value:r.sessions,onChange:o})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Precios"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"selling_price",children:"Precio de Venta"}),e.jsx(g,{id:"selling_price",type:"number",step:"1",placeholder:"299.99",min:"0",value:r.selling_price,onChange:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"discount_price",children:"Precio con Descuento"}),e.jsx(g,{id:"discount_price",type:"number",step:"0.5",placeholder:"199.99",min:"0",value:r.discount_price,onChange:o})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Prerrequisitos"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"prerequisites",children:"Cursos Prerrequisitos"}),e.jsxs(F,{onValueChange:C,disabled:N,children:[e.jsx(D,{id:"prerequisites",children:e.jsx(A,{placeholder:N?"Cargando cursos...":"Selecciona cursos prerrequisitos (opcional)"})}),e.jsxs($,{children:[e.jsx(E,{value:"none",children:"Sin prerrequisitos"}),y.map(t=>e.jsx(E,{value:t.id,disabled:r.prerequisites.includes(t.id),children:t.title},t.id))]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Los prerrequisitos ayudan a los estudiantes a saber qué conocimientos previos necesitan"}),r.prerequisites.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:r.prerequisites.map(t=>{const s=n(t);return e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm",children:[e.jsx("span",{children:s}),e.jsx("button",{type:"button",onClick:()=>S(t),className:"hover:text-blue-900 transition-colors",children:e.jsx(ae,{className:"h-4 w-4"})})]},t)})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Certificación"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"certificate_issuer",children:"Emisor del Certificado"}),e.jsx(g,{id:"certificate_issuer",placeholder:"Universidad Incadev",maxLength:255,value:r.certificate_issuer,onChange:o})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(q,{type:"button",variant:"outline",className:"flex-1",onClick:()=>window.location.hash="",disabled:j,children:"Cancelar"}),e.jsx(q,{type:"submit",className:"flex-1",disabled:j,children:j?"Creando...":"Crear Curso"})]})]})]})]})})})}function be(){const[f,j]=i.useState(null),[d,m]=i.useState(null),[h,y]=i.useState(!1),[x,N]=i.useState("default"),[w,_]=i.useState([]);return i.useEffect(()=>{const r=window.localStorage.getItem("token"),a=window.localStorage.getItem("user");j(r??null);try{m(a?JSON.parse(a):null)}catch{m(null)}y(!0)},[]),i.useEffect(()=>{const r=()=>{const a=window.location.hash.substring(1);if(d?.role==="student"&&(a==="crear-grupo"||a==="crear-curso")){window.location.hash="";return}N(a==="historial"?"historial":a==="crear-grupo"?"crear-grupo":a==="crear-curso"?"crear-curso":"default")};return r(),window.addEventListener("hashchange",r),()=>window.removeEventListener("hashchange",r)},[d?.role]),h?e.jsxs(H,{style:{"--sidebar-width":"calc(var(--spacing) * 72)","--header-height":"calc(var(--spacing) * 12)"},children:[e.jsx(W,{variant:"inset",token:f,user:d}),e.jsxs(J,{children:[e.jsx(Q,{title:x==="historial"?"Historial de Cursos":x==="crear-grupo"&&d?.role!=="student"?"Crear Grupo":x==="crear-curso"&&d?.role!=="student"?"Crear Curso":"Mis Cursos"}),e.jsx("div",{className:"flex flex-1 flex-col",children:e.jsx("div",{className:"@container/main flex flex-1 flex-col gap-2",children:e.jsxs("div",{className:"flex flex-col gap-4 py-4 md:gap-6 md:py-6",children:[x==="default"&&e.jsx(te,{}),x==="historial"&&e.jsx(oe,{}),x==="crear-grupo"&&d?.role!=="student"&&e.jsx(ie,{token:f,user:d}),x==="crear-curso"&&d?.role!=="student"&&e.jsx(ne,{token:f})]})})})]})]}):null}export{be as default};
