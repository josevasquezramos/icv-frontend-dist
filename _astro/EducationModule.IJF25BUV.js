import{c as C,j as e,B as _}from"./config.DA722Lej.js";import{r as n}from"./index.BVn2TZg3.js";import{B as X,X as de,S as me,A as ue,a as xe,b as he}from"./site-header.CcIO_pl4.js";import{C as I,b as R,c as z,d as V,a as O}from"./card.BSoSeF1_.js";import{B as ee}from"./badge.FyzJaTHz.js";import{A as W,a as J,b as Q}from"./alert.O9yGhm7j.js";import{L as H,C as Z,F,a as se,P as pe}from"./presentation.D3ckMBOr.js";import{c as B}from"./createLucideIcon.Cw3puCNq.js";import{C as ge,a as fe}from"./clock.DgRlrvGp.js";import{U as je,S as ye}from"./users.BmZTO0FZ.js";import{I as A}from"./input.BGbgNwpT.js";import{L as S}from"./label.C2QC9qaa.js";import{S as ae,a as re,b as te,c as le,d as E}from"./select.KVc0F5mA.js";import{L as Ne,U as q,C as ve}from"./CloudinaryUploader.C4WVz9yp.js";import{t as G}from"./index.DTvBjT24.js";import{V as be,I as Ce}from"./video.BZwMdyWj.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Ee=B("chevron-left",we);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],K=B("circle-check-big",Se);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],De=B("link",_e);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ne=B("trash-2",Le);function Te({token:x,groupId:N,refreshTrigger:f,isTeacher:v,onClassesUpdated:h,onEditClass:b}){const[i,p]=n.useState([]),[t,c]=n.useState(!0),[d,g]=n.useState(null),[y,m]=n.useState(null);n.useEffect(()=>{u()},[f]);const u=async()=>{c(!0);try{const r=x?.replace(/^"|"$/g,""),w=`${C.apiUrl}${C.endpoints.classes.getByGroup}`.replace(":groupId",N),D=await fetch(w,{method:"GET",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(!D.ok)throw new Error("Error al cargar las clases");const $=await D.json(),U=Array.isArray($)?$:$.classes||[];p(U)}catch(r){console.error("Error:",r),g({type:"error",text:"Error al cargar las clases"})}finally{c(!1)}},j=async r=>{if(window.confirm("¿Estás seguro de que deseas eliminar esta clase?")){m(r);try{const w=x?.replace(/^"|"$/g,""),D=`${C.apiUrl}${C.endpoints.classes.delete}`.replace(":class",String(r));if(!(await fetch(D,{method:"DELETE",headers:{Authorization:`Bearer ${w}`,"Content-Type":"application/json"}})).ok)throw new Error("Error al eliminar la clase");g({type:"success",text:"Clase eliminada exitosamente"}),p(i.filter(U=>U.id!==r)),setTimeout(()=>g(null),3e3)}catch(w){console.error("Error:",w),g({type:"error",text:"Error al eliminar la clase"})}finally{m(null)}}},l=r=>{switch(r){case"SCHEDULED":return"bg-blue-500/10 text-blue-500 border-blue-500/20";case"IN_PROGRESS":return"bg-green-500/10 text-green-500 border-green-500/20";case"COMPLETED":return"bg-gray-500/10 text-gray-500 border-gray-500/20";case"CANCELLED":return"bg-red-500/10 text-red-500 border-red-500/20";default:return"bg-gray-500/10 text-gray-500 border-gray-500/20"}},o=r=>({SCHEDULED:"Programada",IN_PROGRESS:"En Progreso",COMPLETED:"Completada",CANCELLED:"Cancelada"})[r]||r,M=r=>new Date(r).toLocaleDateString("es-ES",{day:"2-digit",month:"long",year:"numeric"}),L=r=>new Date(r).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"});return t?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(H,{className:"h-8 w-8 animate-spin text-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"Cargando clases..."})]})}):e.jsxs("div",{className:"space-y-4",children:[d&&e.jsxs(W,{variant:d.type==="error"?"destructive":"default",children:[d.type==="success"?e.jsx(K,{className:"h-4 w-4"}):e.jsx(Z,{className:"h-4 w-4"}),e.jsx(J,{children:d.type==="success"?"¡Éxito!":"Error"}),e.jsx(Q,{children:d.text})]}),e.jsxs(I,{children:[e.jsxs(R,{children:[e.jsx(z,{children:"Clases del Grupo"}),e.jsx(V,{children:i.length===0?"No hay clases programadas aún":`${i.length} clase${i.length!==1?"s":""} programada${i.length!==1?"s":""}`})]}),e.jsx(O,{children:i.length===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed rounded-lg",children:[e.jsx(X,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No hay clases programadas. Crea la primera clase arriba."})]}):e.jsx("div",{className:"space-y-3",children:i.map(r=>e.jsxs("div",{className:"flex items-start justify-between gap-4 p-4 rounded-lg border hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1 min-w-0",children:[e.jsx("div",{className:"p-2.5 bg-muted rounded-lg flex-shrink-0 mt-0.5",children:e.jsx(X,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[e.jsx("h3",{className:"font-semibold text-base truncate",children:r.class_name}),e.jsx(ee,{className:l(r.class_status),children:o(r.class_status)})]}),r.description&&e.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:r.description}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ge,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:M(r.class_date)})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(fe,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[L(r.start_time)," - ",L(r.end_time)]})]}),r.attendances&&r.attendances.length>0&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(je,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[r.attendances.length," asistencias"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>{const D=new URLSearchParams(window.location.search).get("groupId");window.location.href=`/academico/dashboard/courses/clase?classId=${r.id}&groupId=${D}`},className:"gap-2",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Ver Clase"})]}),v&&e.jsxs(e.Fragment,{children:[e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>b(r.id),title:"Gestionar materiales",children:e.jsx(ye,{className:"h-4 w-4"})}),e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>j(r.id),disabled:y===r.id,className:"text-red-500 hover:text-red-600 hover:bg-red-500/10",title:"Eliminar clase",children:e.jsx(ne,{className:"h-4 w-4"})})]})]})]},r.id))})})]})]})}function ke({token:x,groupId:N,onClassAdded:f,isTeacher:v}){const[h,b]=n.useState(!1),[i,p]=n.useState(null),[t,c]=n.useState({class_name:"",description:"",class_date:"",start_time:"",end_time:"",meeting_url:"",class_status:"SCHEDULED"}),d=m=>{const{name:u,value:j}=m.target;c(l=>({...l,[u]:j}))},g=m=>{c(u=>({...u,class_status:m}))},y=async m=>{if(m.preventDefault(),!v){p({type:"error",text:"Solo los docentes pueden crear clases"});return}b(!0);try{const u=x?.replace(/^"|"$/g,""),j=new Date(t.class_date),l=new Date(`${t.class_date}T${t.start_time}`),o=new Date(`${t.class_date}T${t.end_time}`),M={group_id:parseInt(N),class_name:t.class_name,description:t.description,class_date:j.toISOString().split("T")[0],start_time:l.toISOString().replace("T"," ").substring(0,19),end_time:o.toISOString().replace("T"," ").substring(0,19),meeting_url:t.meeting_url||null,class_status:t.class_status},L=await fetch(`${C.apiUrl}${C.endpoints.classes.create}`,{method:"POST",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"},body:JSON.stringify(M)});if(!L.ok){const r=await L.json();throw new Error(r.message||"Error al crear la clase")}p({type:"success",text:`Clase "${t.class_name}" creada exitosamente`}),c({class_name:"",description:"",class_date:"",start_time:"",end_time:"",meeting_url:"",class_status:"SCHEDULED"}),f(),setTimeout(()=>p(null),3e3)}catch(u){console.error("Error:",u),p({type:"error",text:u instanceof Error?u.message:"Error al crear la clase"})}finally{b(!1)}};return v?e.jsxs(I,{children:[e.jsxs(R,{children:[e.jsx(z,{children:"Crear Nueva Clase"}),e.jsx(V,{children:"Agrega una nueva sesión de clase al grupo"})]}),e.jsxs(O,{children:[i&&e.jsxs(W,{variant:i.type==="error"?"destructive":"default",className:"mb-6",children:[i.type==="success"?e.jsx(K,{className:"h-4 w-4"}):e.jsx(Z,{className:"h-4 w-4"}),e.jsx(J,{children:i.type==="success"?"¡Éxito!":"Error"}),e.jsx(Q,{children:i.text})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"class_name",children:"Nombre de la Clase *"}),e.jsx(A,{id:"class_name",name:"class_name",placeholder:"Ej: Introducción a HTML",value:t.class_name,onChange:d,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"description",children:"Descripción"}),e.jsx("textarea",{id:"description",name:"description",placeholder:"Describe el contenido de la clase...",className:"flex min-h-[100px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:t.description,onChange:d})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"meeting_url",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4"}),"Enlace de la Reunión (Opcional)"]})}),e.jsx(A,{id:"meeting_url",name:"meeting_url",type:"url",placeholder:"https://meet.google.com/xxx-xxxx-xxx",value:t.meeting_url,onChange:d}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Agrega el enlace de Zoom, Google Meet, Teams, etc."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"class_date",children:"Fecha de la Clase *"}),e.jsx(A,{id:"class_date",name:"class_date",type:"date",value:t.class_date,onChange:d,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"start_time",children:"Hora de Inicio *"}),e.jsx(A,{id:"start_time",name:"start_time",type:"time",value:t.start_time,onChange:d,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"end_time",children:"Hora de Fin *"}),e.jsx(A,{id:"end_time",name:"end_time",type:"time",value:t.end_time,onChange:d,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"class_status",children:"Estado *"}),e.jsxs(ae,{value:t.class_status,onValueChange:g,children:[e.jsx(re,{id:"class_status",children:e.jsx(te,{})}),e.jsxs(le,{children:[e.jsx(E,{value:"SCHEDULED",children:"Programada"}),e.jsx(E,{value:"IN_PROGRESS",children:"En Progreso"}),e.jsx(E,{value:"COMPLETED",children:"Completada"}),e.jsx(E,{value:"CANCELLED",children:"Cancelada"})]})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(_,{type:"button",variant:"outline",className:"flex-1",onClick:()=>c({class_name:"",description:"",class_date:"",start_time:"",end_time:"",meeting_url:"",class_status:"SCHEDULED"}),disabled:h,children:"Limpiar"}),e.jsxs(_,{type:"button",onClick:y,className:"flex-1 gap-2",disabled:h,children:[e.jsx(X,{className:"h-4 w-4"}),h?"Creando...":"Crear Clase"]})]})]})]})]}):null}const Pe=({onUpload:x,label:N="Subir documento a Drive"})=>{const[f,v]=n.useState(""),[h,b]=n.useState(""),[i,p]=n.useState(!1),t="https://script.google.com/macros/s/AKfycbz4X_Z-A4cZMc6Nu_I71ACsu0gVhQyyVlIYyNmN67rKfNEep4kDXSqfHohLFSHFIWLGxg/exec",c=async d=>{const g=d.target.files;if(!g||g.length===0)return;const y=g[0];b(y.name),p(!0);try{const m=new FileReader;m.readAsDataURL(y),m.onload=async()=>{try{const j={dataReq:{data:m.result.split(",")[1],name:y.name,type:y.type},fname:"uploadFilesToGoogleDrive"},o=await(await fetch(t,{method:"POST",body:JSON.stringify(j)})).json();if(o.url)v(o.url),G.success("Archivo subido correctamente a Google Drive"),x&&x(o.url);else if(o.obj?.url)v(o.obj.url),G.success("Archivo subido correctamente a Google Drive"),x&&x(o.obj.url);else throw new Error("No se recibió la URL del archivo.")}catch(u){console.error("Error durante la subida:",u),G.error("No se pudo subir el archivo a Drive.")}finally{p(!1)}}}catch(m){console.error("Error:",m),G.error("Error al procesar el archivo."),p(!1)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"drive-upload",className:"text-sm font-medium",children:N}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"drive-upload",type:"file",name:"file",accept:".pdf,.doc,.docx,.ppt,.pptx,.txt,.xlsx",onChange:c,className:"sr-only",disabled:i}),e.jsx("label",{htmlFor:"drive-upload",className:`flex flex-col items-center justify-center w-full h-32 px-4 py-6 border-2 border-dashed rounded-lg cursor-pointer transition-all ${i?"border-gray-300 bg-gray-50 cursor-not-allowed":"border-gray-300 hover:border-primary hover:bg-accent/50"}`,children:i?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(Ne,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Subiendo a Drive..."})]}):e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(q,{className:"h-8 w-8 text-muted-foreground"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Haz clic para subir"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Formatos permitidos: PDF, DOCX, PPTX, XLSX, TXT"})]})]})})]})]}),f&&!i&&e.jsx(I,{className:"overflow-hidden",children:e.jsxs(O,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[h.endsWith(".pdf")?e.jsx(F,{className:"h-5 w-5 text-primary"}):e.jsx(se,{className:"h-5 w-5 text-blue-500"}),e.jsx("span",{children:h})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground pt-2",children:[e.jsx("span",{children:"Documento cargado exitosamente"}),e.jsx("a",{href:f,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"Abrir en Drive"})]})]})})]})};function $e({token:x,classId:N,isTeacher:f,onClose:v}){const[h,b]=n.useState([]),[i,p]=n.useState(!0),[t,c]=n.useState(null),[d,g]=n.useState(null),[y,m]=n.useState(!1),[u,j]=n.useState(!1),[l,o]=n.useState({material_url:"",type:"PDF"});n.useEffect(()=>{M()},[N]);const M=async()=>{p(!0);try{const a=x?.replace(/^"|"$/g,""),s=`${C.apiUrl}${C.endpoints.materials.getByClass}`.replace(":classId",String(N)),T=await fetch(s,{method:"GET",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!T.ok)throw new Error("Error al cargar los materiales");const k=await T.json(),P=Array.isArray(k.data)?k.data:[];b(P)}catch(a){console.error("Error:",a),c({type:"error",text:"Error al cargar los materiales"})}finally{p(!1)}},L=a=>{o(s=>({...s,type:a}))},r=async a=>{if(a.preventDefault(),!f){c({type:"error",text:"Solo los docentes pueden cargar materiales"});return}if(!l.material_url.trim()){c({type:"error",text:"Debes proporcionar una URL válida"});return}m(!0);try{const s=x?.replace(/^"|"$/g,""),T=`${C.apiUrl}${C.endpoints.materials.create}`.replace(":classId",String(N)),k={class_id:N,material_url:l.material_url,type:l.type},P=await fetch(T,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(k)});if(!P.ok){const ce=await P.json();throw new Error(ce.message||"Error al cargar el material")}const Y=await P.json(),oe=Y.data||Y;c({type:"success",text:`Material tipo ${l.type} cargado exitosamente`}),b([oe,...h]),o({material_url:"",type:"PDF"}),j(!1),setTimeout(()=>c(null),3e3)}catch(s){console.error("Error:",s),c({type:"error",text:s instanceof Error?s.message:"Error al cargar el material"})}finally{m(!1)}},w=async a=>{if(window.confirm("¿Estás seguro de que deseas eliminar este material?")){g(a);try{const s=x?.replace(/^"|"$/g,""),T=`${C.apiUrl}${C.endpoints.materials.delete}`.replace(":materialId",String(a));if(!(await fetch(T,{method:"DELETE",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}})).ok)throw new Error("Error al eliminar el material");c({type:"success",text:"Material eliminado exitosamente"}),b(h.filter(P=>P.id!==a)),setTimeout(()=>c(null),3e3)}catch(s){console.error("Error:",s),c({type:"error",text:"Error al eliminar el material"})}finally{g(null)}}},D=a=>{const s=a.toUpperCase();return s==="VIDEO"?e.jsx(be,{className:"h-5 w-5"}):s==="PDF"?e.jsx(F,{className:"h-5 w-5"}):s==="DOCX"||s==="DOC"?e.jsx(se,{className:"h-5 w-5"}):s==="PPTX"||s==="PPT"?e.jsx(pe,{className:"h-5 w-5"}):s==="IMAGEN"||s==="JPG"||s==="PNG"||s==="JPEG"?e.jsx(Ce,{className:"h-5 w-5"}):s==="XLSX"||s==="XLS"?e.jsx(F,{className:"h-5 w-5"}):e.jsx(X,{className:"h-5 w-5"})},$=a=>{const s=a.toUpperCase();return s==="VIDEO"?"bg-red-500/10 text-red-500 border-red-500/20":s==="PDF"?"bg-purple-500/10 text-purple-500 border-purple-500/20":s==="DOCX"||s==="DOC"?"bg-blue-500/10 text-blue-500 border-blue-500/20":s==="PPTX"||s==="PPT"?"bg-orange-500/10 text-orange-500 border-orange-500/20":s==="IMAGEN"||s==="JPG"||s==="PNG"||s==="JPEG"?"bg-green-500/10 text-green-500 border-green-500/20":s==="XLSX"||s==="XLS"?"bg-emerald-500/10 text-emerald-500 border-emerald-500/20":"bg-gray-500/10 text-gray-500 border-gray-500/20"},U=a=>new Date(a).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),ie=a=>{try{const k=new URL(a).pathname.split("/").pop()||a;return decodeURIComponent(k)}catch{return a}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-background rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Materiales de la Clase"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Gestiona los recursos educativos de esta sesión"})]}),e.jsx(_,{variant:"ghost",size:"icon",onClick:v,className:"rounded-full",children:e.jsx(de,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[t&&e.jsxs(W,{variant:t.type==="error"?"destructive":"default",children:[t.type==="success"?e.jsx(K,{className:"h-4 w-4"}):e.jsx(Z,{className:"h-4 w-4"}),e.jsx(J,{children:t.type==="success"?"¡Éxito!":"Error"}),e.jsx(Q,{children:t.text})]}),f&&!u&&e.jsxs(_,{onClick:()=>j(!0),className:"w-full gap-2",size:"lg",children:[e.jsx(q,{className:"h-4 w-4"}),"Agregar Nuevo Material"]}),f&&u&&e.jsxs(I,{children:[e.jsxs(R,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(z,{children:"Nuevo Material"}),e.jsxs(_,{variant:"ghost",size:"sm",onClick:()=>j(!1),children:[e.jsx(Ee,{className:"h-4 w-4 mr-1"}),"Cancelar"]})]}),e.jsx(V,{children:"Carga documentos, videos, imágenes y otros recursos educativos"})]}),e.jsx(O,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"type",children:"Tipo de Material *"}),e.jsxs(ae,{value:l.type,onValueChange:L,children:[e.jsx(re,{id:"type",children:e.jsx(te,{})}),e.jsxs(le,{children:[e.jsx(E,{value:"PDF",children:"PDF"}),e.jsx(E,{value:"DOCX",children:"DOCX (Word)"}),e.jsx(E,{value:"PPTX",children:"PPTX (PowerPoint)"}),e.jsx(E,{value:"XLSX",children:"XLSX (Excel)"}),e.jsx(E,{value:"VIDEO",children:"Video"}),e.jsx(E,{value:"IMAGEN",children:"Imagen"}),e.jsx(E,{value:"ENLACE",children:"Enlace Web"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"material_url",children:"Archivo o Enlace del Material *"}),l.type.toUpperCase()==="ENLACE"?e.jsx(A,{id:"material_url",type:"url",placeholder:"https://ejemplo.com/recurso",value:l.material_url,onChange:a=>o(s=>({...s,material_url:a.target.value}))}):["VIDEO","IMAGEN"].includes(l.type.toUpperCase())?e.jsx(ve,{onUpload:a=>o(s=>({...s,material_url:a})),label:`Subir ${l.type}`,acceptType:l.type.toUpperCase()==="IMAGEN"?"image":l.type.toUpperCase()==="VIDEO"?"video":"both"}):e.jsx(Pe,{onUpload:a=>o(s=>({...s,material_url:a})),label:`Subir ${l.type}`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l.type.toUpperCase()==="ENLACE"?"Introduce una URL válida de una página o recurso en línea.":"Los videos e imágenes se almacenan en Cloudinary. Los documentos se suben automáticamente a tu Google Drive."})]}),e.jsxs(_,{onClick:r,className:"w-full gap-2",disabled:y,children:[e.jsx(q,{className:"h-4 w-4"}),y?"Cargando...":"Cargar Material"]})]})})]}),e.jsxs(I,{children:[e.jsxs(R,{children:[e.jsx(z,{children:"Materiales Cargados"}),e.jsx(V,{children:h.length===0?"No hay materiales cargados aún":`${h.length} material${h.length!==1?"es":""} disponible${h.length!==1?"s":""}`})]}),e.jsx(O,{children:i?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(H,{className:"h-8 w-8 animate-spin text-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"Cargando materiales..."})]})}):h.length===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed rounded-lg",children:[e.jsx(F,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No hay materiales cargados en esta clase."})]}):e.jsx("div",{className:"space-y-3",children:h.map(a=>e.jsxs("div",{className:"flex items-start justify-between gap-4 p-4 rounded-lg border hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1 min-w-0",children:[e.jsx("div",{className:"p-2.5 bg-muted rounded-lg flex-shrink-0 mt-0.5",children:D(a.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[e.jsx("h3",{className:"font-semibold text-base truncate",children:ie(a.material_url)}),e.jsx(ee,{className:$(a.type),children:a.type})]}),e.jsxs("div",{className:"flex flex-col gap-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Creado: ",U(a.created_at)]}),e.jsx("a",{href:a.material_url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline truncate block",children:"Ver material →"})]})]})]}),f&&e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>w(a.id),disabled:d===a.id,className:"text-red-500 hover:text-red-600 hover:bg-red-500/10",children:d===a.id?e.jsx(H,{className:"h-4 w-4 animate-spin"}):e.jsx(ne,{className:"h-4 w-4"})})})]},a.id))})})]})]})]})})}function Qe(){const[x,N]=n.useState(null),[f,v]=n.useState(null),[h,b]=n.useState(!1),[i,p]=n.useState(null),[t,c]=n.useState(0),[d,g]=n.useState(null);n.useEffect(()=>{const l=window.localStorage.getItem("token"),o=window.localStorage.getItem("user");N(l??null);try{v(o?JSON.parse(o):null)}catch{v(null)}b(!0)},[]),n.useEffect(()=>{if(typeof window>"u")return;const o=new URLSearchParams(window.location.search).get("groupId");o&&p(o)},[]);const y=()=>{c(l=>l+1)},m=l=>{g(l)},u=()=>{g(null)};if(!h||!i)return null;const j=f?.role?.includes("teacher")||f?.role?.includes("admin");return e.jsxs(me,{style:{"--sidebar-width":"calc(var(--spacing) * 72)","--header-height":"calc(var(--spacing) * 12)"},children:[e.jsx(ue,{variant:"inset",token:x,user:f}),e.jsxs(xe,{children:[e.jsx(he,{title:"Módulo Educativo"}),e.jsx("div",{className:"flex flex-1 flex-col",children:e.jsx("div",{className:"@container/main flex flex-1 flex-col gap-2",children:e.jsxs("div",{className:"flex flex-col gap-4 py-4 md:gap-6 md:py-6 px-4 md:px-6 lg:px-10",children:[e.jsx(ke,{token:x,groupId:i,onClassAdded:y,isTeacher:j}),e.jsx(Te,{token:x,groupId:i,refreshTrigger:t,isTeacher:j,onClassesUpdated:y,onEditClass:m})]})})}),d&&e.jsx($e,{token:x,classId:d,isTeacher:j,onClose:u})]})]})}export{Qe as default};
