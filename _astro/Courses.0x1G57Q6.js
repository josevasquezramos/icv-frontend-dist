import{j as e,B as k,c as b}from"./config.DA722Lej.js";import{r as i}from"./index.BVn2TZg3.js";import{c as R,d as z,e as V,f as H,S as W,A as J,a as Q,b as X}from"./site-header.CcIO_pl4.js";import{C as I,b as L,a as G,e as K}from"./card.BSoSeF1_.js";import{P as Y}from"./progress.CPUoIT4Q.js";import{t as q}from"./index.DTvBjT24.js";import{c as Z}from"./createLucideIcon.Cw3puCNq.js";import{I as f}from"./input.BGbgNwpT.js";import{L as p}from"./label.C2QC9qaa.js";import{A as T,a as U,b as P}from"./alert.O9yGhm7j.js";import{S as F,a as D,b as A,c as $,d as E}from"./select.KVc0F5mA.js";import{I as M}from"./IconCheck.CXf9P-ea.js";import{I as B}from"./IconAlertCircle.CnD7sKOg.js";import{C as ee}from"./CloudinaryUploader.C4WVz9yp.js";import"./video.BZwMdyWj.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],re=Z("download",se);/**
 * @license @tabler/icons-react v3.35.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M18 6l-12 12",key:"svg-0"}],["path",{d:"M6 6l12 12",key:"svg-1"}]],te=R("outline","x","X",ae);function oe(){return e.jsx("section",{className:"px-4 md:px-6 lg:px-10",children:e.jsx("p",{className:"text-muted-foreground",children:'Vista principal de "Mis Cursos". Aquí se mostrarán los cursos activos del usuario.'})})}function ie(){const[j,v]=i.useState([]),[m,y]=i.useState([]),[N,w]=i.useState(!0),[x,C]=i.useState(null),[_,S]=i.useState(null);i.useEffect(()=>{(async()=>{try{w(!0);const d=window.localStorage.getItem("token");S(d??null);const g=window.localStorage.getItem("user"),u=g?JSON.parse(g).id:null;if(!u){q.error("No se pudo identificar al usuario");return}const n=b.endpoints.groups.getGroupsCompleted.replace(":userId",String(u)),a=`${b.apiUrl}${n}`,r=d?.replace(/^"|"$/g,""),c=await fetch(a,{method:"GET",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(!c.ok)throw new Error("Error al obtener los grupos completados");const l=await c.json();console.log(l.groups),l.groups&&Array.isArray(l.groups)?v(l.groups):v([])}catch(d){console.error("Error fetching completed groups:",d),q.error("Error al cargar los cursos completados"),v([])}finally{w(!1)}})()},[]);const s=async(o,d)=>{if(console.log(d),!d){q.error("Este curso no tiene un certificado disponible.");return}C(o);try{const g=_?.replace(/^"|"$/g,""),u=b.endpoints.certificates.generate.replace(":credentialId",String(d)),n=`${b.apiUrl}${u}`;console.log("Descargando certificado desde:",n);const a=await fetch(n,{method:"GET",headers:{Authorization:`Bearer ${g}`,Accept:"application/json"}});if(!a.ok){const O=await a.json().catch(()=>({}));throw new Error(O.message||"Error al generar el certificado")}const r=await a.blob(),c=window.URL.createObjectURL(r),l=document.createElement("a");l.href=c,l.download=`certificado-${o}.pdf`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(c),q.success("¡Certificado descargado exitosamente!")}catch(g){console.error("Error descargando certificado:",g),q.error(g instanceof Error?g.message:"Error al descargar el certificado. Por favor, intenta nuevamente.")}finally{C(null)}},t=o=>o.find(d=>d.role==="teacher")?.user||null,h=o=>o.course_image||"/academico/images/default-group-01.webp";return N?e.jsx("section",{className:"px-4 md:px-6 lg:px-10",children:e.jsx("p",{className:"text-center text-muted-foreground py-12",children:"Cargando cursos completados..."})}):e.jsx("section",{className:"px-4 md:px-6 lg:px-10",children:j.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-12",children:"No tienes cursos completados aún."}):e.jsx("div",{className:"grid gap-6 sm:grid-cols-2 lg:grid-cols-3",children:j.map(o=>{const d=t(o.participants),g=h(o.course);return e.jsxs(I,{className:"overflow-hidden transition-all hover:shadow-lg flex flex-col",children:[e.jsx("div",{className:"aspect-video overflow-hidden cursor-pointer",children:e.jsx("img",{src:g,alt:o.course.name,className:"w-full h-full object-cover hover:scale-105 transition-transform"})}),e.jsxs(L,{className:"pb-3",children:[e.jsx("h3",{className:"font-semibold text-lg",children:o.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o.course.name})]}),e.jsxs(G,{className:"space-y-4 flex-1",children:[d&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(z,{className:"h-10 w-10",children:[e.jsx(V,{src:d.profile_photo}),e.jsx(H,{children:d.full_name?.split(" ").map(u=>u[0]).join("")||"T"})]}),e.jsx("p",{className:"text-sm font-medium",children:d.full_name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"Completado"}),e.jsx("span",{className:"text-green-600 font-medium",children:"100%"})]}),e.jsx(Y,{value:100})]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["Inicio: ",new Date(o.start_date).toLocaleDateString()]}),e.jsxs("p",{children:["Fin: ",new Date(o.end_date).toLocaleDateString()]})]})]}),e.jsx(K,{className:"gap-2",children:e.jsxs(k,{variant:"outline",className:"flex-1 gap-2",onClick:()=>s(o.id,o.credentials?.[0]?.id),disabled:x===o.id,children:[e.jsx(re,{className:"h-4 w-4"}),x===o.id?"Descargando...":"Certificado"]})})]},o.id)})})})}function ne({token:j,user:v}){const[m,y]=i.useState(!1),[N,w]=i.useState(null),[x,C]=i.useState([]),[_,S]=i.useState(!0),s=j?.replace(/^"|"$/g,""),[t,h]=i.useState({course_id:"",code:"",name:"",start_date:"",end_date:""});i.useEffect(()=>{(async()=>{S(!0);try{const n=await fetch(`${b.apiUrl}${b.endpoints.courses.getAll}`,{method:"GET",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});if(n.ok){const a=await n.json();C(a)}}catch(n){console.error("Error cargando cursos:",n)}finally{S(!1)}})()},[j]);const o=u=>{const{id:n,value:a}=u.target;h(r=>({...r,[n]:a}))},d=u=>{h(n=>({...n,course_id:u}))},g=async u=>{if(u.preventDefault(),!v){w({type:"error",text:"Usuario no autenticado"});return}y(!0);try{const n={course_id:parseInt(t.course_id),code:t.code,name:t.name,start_date:t.start_date,end_date:t.end_date,teacher_id:v.id};console.log("Enviando datos:",n);const a=await fetch(`${b.apiUrl}${b.endpoints.groups.create}`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(n)}),r=await a.json();if(!a.ok)throw new Error(r.message||"Error al crear el grupo");console.log("Grupo creado:",r),w({type:"success",text:`¡Grupo creado exitosamente! El grupo "${t.name}" ha sido registrado.`}),h({course_id:"",code:"",name:"",start_date:"",end_date:""}),setTimeout(()=>{window.location.hash=""},1500)}catch(n){console.error("Error al crear grupo:",n),w({type:"error",text:n instanceof Error?n.message:"Ocurrió un error inesperado al crear el grupo"})}finally{y(!1)}};return e.jsx("section",{className:"px-4 md:px-6 lg:px-10",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs(I,{children:[e.jsxs(L,{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Crear Nuevo Grupo"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completa la información para crear un nuevo grupo académico"})]}),e.jsxs(G,{children:[N&&e.jsxs(T,{variant:N.type==="error"?"destructive":"default",className:"mb-6",children:[N.type==="success"?e.jsx(M,{className:"h-4 w-4"}):e.jsx(B,{className:"h-4 w-4"}),e.jsx(U,{children:N.type==="success"?"¡Éxito!":"Error"}),e.jsx(P,{children:N.text})]}),e.jsxs("form",{onSubmit:g,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"course_id",children:"Curso *"}),e.jsxs(F,{value:t.course_id,onValueChange:d,disabled:_,children:[e.jsx(D,{id:"course_id",children:e.jsx(A,{placeholder:_?"Cargando cursos...":"Selecciona un curso"})}),e.jsx($,{children:x.map(u=>e.jsx(E,{value:String(u.id),children:u.title},u.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"code",children:"Código del Grupo *"}),e.jsx(f,{id:"code",placeholder:"Ej: GRP-2024-001",value:t.code,onChange:o,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"name",children:"Nombre del Grupo *"}),e.jsx(f,{id:"name",placeholder:"Ej: Grupo A - Mañana",value:t.name,onChange:o,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"start_date",children:"Fecha de Inicio *"}),e.jsx(f,{id:"start_date",type:"date",value:t.start_date,onChange:o,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"end_date",children:"Fecha de Fin *"}),e.jsx(f,{id:"end_date",type:"date",value:t.end_date,onChange:o,required:!0})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(k,{type:"button",variant:"outline",className:"flex-1",onClick:()=>window.location.hash="",disabled:m,children:"Cancelar"}),e.jsx(k,{type:"submit",className:"flex-1",disabled:m,children:m?"Creando...":"Crear Grupo"})]})]})]})]})})})}function ce({token:j}){const[v,m]=i.useState(!1),[y,N]=i.useState(null),[w,x]=i.useState([]),[C,_]=i.useState(!0),S=j?.replace(/^"|"$/g,""),[s,t]=i.useState({course_id:"",title:"",name:"",description:"",level:"basic",course_image:"",video_url:"",duration:"",sessions:"",selling_price:"",discount_price:"",prerequisites:[],certificate_issuer:""});i.useEffect(()=>{(async()=>{_(!0);try{const r=await fetch(`${b.apiUrl}${b.endpoints.courses.getAll}`,{method:"GET",headers:{Authorization:`Bearer ${S}`,"Content-Type":"application/json"}});if(r.ok){const c=await r.json();x(c)}}catch(r){console.error("Error cargando cursos:",r)}finally{_(!1)}})()},[j]);const h=a=>{const{id:r,value:c}=a.target;t(l=>({...l,[r]:c}))},o=(a,r)=>{t(c=>({...c,[a]:r}))},d=a=>{console.log("courseid entrante: ",a);const r=a.toString();!s.prerequisites.some(l=>l.toString()===r)&&a!=="none"?(console.log("prerrequisitos actuales: ",s.prerequisites),t(l=>({...l,prerequisites:[...l.prerequisites,r]}))):console.log("El curso ya existe en prerrequisitos o es 'none'")},g=a=>{t(r=>({...r,prerequisites:r.prerequisites.filter(c=>c!==a)}))},u=async a=>{a.preventDefault(),m(!0);try{const r={course_id:parseInt(s.course_id),title:s.title,level:s.level};s.name&&(r.name=s.name),s.description&&(r.description=s.description),s.course_image&&(r.course_image=s.course_image),s.video_url&&(r.video_url=s.video_url),s.duration&&(r.duration=parseFloat(s.duration)),s.sessions&&(r.sessions=parseInt(s.sessions)),s.selling_price&&(r.selling_price=parseFloat(s.selling_price)),s.discount_price&&(r.discount_price=parseFloat(s.discount_price)),s.prerequisites.length>0&&(r.prerequisites=s.prerequisites.join(",")),s.certificate_issuer&&(r.certificate_issuer=s.certificate_issuer),console.log("Enviando datos:",r);const c=await fetch(`${b.apiUrl}${b.endpoints.courses.create}`,{method:"POST",headers:{Authorization:`Bearer ${S}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(r)}),l=await c.json();if(!c.ok)throw new Error(l.message||"Error al crear el curso");console.log("Curso creado:",l),N({type:"success",text:`¡Curso creado exitosamente! El curso "${s.title}" ha sido registrado.`}),t({course_id:"",title:"",name:"",description:"",level:"basic",course_image:"",video_url:"",duration:"",sessions:"",selling_price:"",discount_price:"",prerequisites:[],certificate_issuer:""}),setTimeout(()=>{window.location.href="/academico/dashboard/catalogo"},1500)}catch(r){console.error("Error al crear curso:",r),N({type:"error",text:r instanceof Error?r.message:"Ocurrió un error inesperado al crear el curso"})}finally{m(!1)}},n=a=>{const r=w.find(c=>c.id===a||c.id?.toString()===a);return console.log("dato del curso: ",r),r?.title};return e.jsx("section",{className:"px-4 md:px-6 lg:px-10",children:e.jsx("div",{className:"max-w-3xl mx-auto",children:e.jsxs(I,{children:[e.jsxs(L,{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Crear Nuevo Curso"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Define la información del curso que será utilizado para crear grupos"})]}),e.jsxs(G,{children:[y&&e.jsxs(T,{variant:y.type==="error"?"destructive":"default",className:"mb-6",children:[y.type==="success"?e.jsx(M,{className:"h-4 w-4"}):e.jsx(B,{className:"h-4 w-4"}),e.jsx(U,{children:y.type==="success"?"¡Éxito!":"Error"}),e.jsx(P,{children:y.text})]}),e.jsxs("form",{onSubmit:u,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Información Básica"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"course_id",children:"ID del Curso *"}),e.jsx(f,{id:"course_id",type:"number",placeholder:"1001",value:s.course_id,onChange:h,min:"1",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"title",children:"Título *"}),e.jsx(f,{id:"title",placeholder:"Desarrollo Web Fullstack",maxLength:255,value:s.title,onChange:h,required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"name",children:"Nombre (opcional)"}),e.jsx(f,{id:"name",placeholder:"DWF 2024",maxLength:200,value:s.name,onChange:h})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"description",children:"Descripción"}),e.jsx("textarea",{id:"description",className:"flex min-h-[120px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"Describe el contenido, objetivos y metodología del curso...",value:s.description,onChange:h})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"level",children:"Nivel *"}),e.jsxs(F,{value:s.level,onValueChange:a=>o("level",a),children:[e.jsx(D,{id:"level",children:e.jsx(A,{placeholder:"Selecciona un nivel"})}),e.jsxs($,{children:[e.jsx(E,{value:"basic",children:"Básico"}),e.jsx(E,{value:"intermediate",children:"Intermedio"}),e.jsx(E,{value:"advanced",children:"Avanzado"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Multimedia"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"course_image",children:"URL de Imagen del Curso"}),e.jsx(ee,{onUpload:a=>t(r=>({...r,course_image:a})),acceptType:"image"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"video_url",children:"URL de Video Promocional"}),e.jsx(f,{id:"video_url",type:"url",placeholder:"https://youtube.com/watch?v=...",maxLength:255,value:s.video_url,onChange:h})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Detalles del Curso"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"duration",children:"Duración (horas)"}),e.jsx(f,{id:"duration",type:"number",step:"1",placeholder:"120",min:"1",value:s.duration,onChange:h})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"sessions",children:"Número de Sesiones"}),e.jsx(f,{id:"sessions",type:"number",placeholder:"40",min:"0",value:s.sessions,onChange:h})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Precios"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"selling_price",children:"Precio de Venta"}),e.jsx(f,{id:"selling_price",type:"number",step:"1",placeholder:"299.99",min:"0",value:s.selling_price,onChange:h})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"discount_price",children:"Precio con Descuento"}),e.jsx(f,{id:"discount_price",type:"number",step:"0.5",placeholder:"199.99",min:"0",value:s.discount_price,onChange:h})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Prerrequisitos"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"prerequisites",children:"Cursos Prerrequisitos"}),e.jsxs(F,{onValueChange:d,disabled:C,children:[e.jsx(D,{id:"prerequisites",children:e.jsx(A,{placeholder:C?"Cargando cursos...":"Selecciona cursos prerrequisitos (opcional)"})}),e.jsxs($,{children:[e.jsx(E,{value:"none",children:"Sin prerrequisitos"}),w.map(a=>e.jsx(E,{value:a.id,disabled:s.prerequisites.includes(a.id),children:a.title},a.id))]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Los prerrequisitos ayudan a los estudiantes a saber qué conocimientos previos necesitan"}),s.prerequisites.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:s.prerequisites.map(a=>{const r=n(a);return e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm",children:[e.jsx("span",{children:r}),e.jsx("button",{type:"button",onClick:()=>g(a),className:"hover:text-blue-900 transition-colors",children:e.jsx(te,{className:"h-4 w-4"})})]},a)})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Certificación"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"certificate_issuer",children:"Emisor del Certificado"}),e.jsx(f,{id:"certificate_issuer",placeholder:"Universidad Incadev",maxLength:255,value:s.certificate_issuer,onChange:h})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(k,{type:"button",variant:"outline",className:"flex-1",onClick:()=>window.location.hash="",disabled:v,children:"Cancelar"}),e.jsx(k,{type:"submit",className:"flex-1",disabled:v,children:v?"Creando...":"Crear Curso"})]})]})]})]})})})}function we(){const[j,v]=i.useState(null),[m,y]=i.useState(null),[N,w]=i.useState(!1),[x,C]=i.useState("default"),[_,S]=i.useState([]);return i.useEffect(()=>{const s=window.localStorage.getItem("token"),t=window.localStorage.getItem("user");v(s??null);try{y(t?JSON.parse(t):null)}catch{y(null)}w(!0)},[]),i.useEffect(()=>{const s=()=>{const t=window.location.hash.substring(1);if(m?.role==="student"&&(t==="crear-grupo"||t==="crear-curso")){window.location.hash="";return}C(t==="historial"?"historial":t==="crear-grupo"?"crear-grupo":t==="crear-curso"?"crear-curso":"default")};return s(),window.addEventListener("hashchange",s),()=>window.removeEventListener("hashchange",s)},[m?.role]),N?e.jsxs(W,{style:{"--sidebar-width":"calc(var(--spacing) * 72)","--header-height":"calc(var(--spacing) * 12)"},children:[e.jsx(J,{variant:"inset",token:j,user:m}),e.jsxs(Q,{children:[e.jsx(X,{title:x==="historial"?"Historial de Cursos":x==="crear-grupo"&&m?.role!=="student"?"Crear Grupo":x==="crear-curso"&&m?.role!=="student"?"Crear Curso":"Mis Cursos"}),e.jsx("div",{className:"flex flex-1 flex-col",children:e.jsx("div",{className:"@container/main flex flex-1 flex-col gap-2",children:e.jsxs("div",{className:"flex flex-col gap-4 py-4 md:gap-6 md:py-6",children:[x==="default"&&e.jsx(oe,{}),x==="historial"&&e.jsx(ie,{}),x==="crear-grupo"&&m?.role!=="student"&&e.jsx(ne,{token:j,user:m}),x==="crear-curso"&&m?.role!=="student"&&e.jsx(ce,{token:j})]})})})]})]}):null}export{we as default};
